# Data

**Last updated:** 2026-02-05

## Training Data

### data/vae_training_data_v2_20cm.csv

**Main training dataset for VAE models.**

| Property | Value |
|----------|-------|
| File size | 25,597,891 bytes (25.6 MB) |
| Rows | 238,507 (including header) |
| Samples | 238,506 |
| Columns | 9 |

**Schema:**

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| `Borehole_ID` | string | Expedition-Site-Hole identifier | `346-U1422-A` |
| `Depth_Bin` | float | Depth in meters (0.2m bins) | `0.0`, `0.2`, `0.4` |
| `Bulk density (GRA)` | float | Gamma-ray attenuation density (g/cm³) | `1.134` |
| `Principal` | string | Primary lithology classification | `clay`, `silty clay` |
| `Magnetic susceptibility (instr. units)` | float | Magnetic susceptibility | `12.97` |
| `NGR total counts (cps)` | float | Natural gamma radiation (counts/sec) | `34.40` |
| `R` | float | Red channel (0-255 scale) | `49.71` |
| `G` | float | Green channel | `47.60` |
| `B` | float | Blue channel | `45.73` |

**Feature columns used for training (6D):**
```python
FEATURE_COLS = [
    'Bulk density (GRA)',
    'Magnetic susceptibility (instr. units)',
    'NGR total counts (cps)',
    'R', 'G', 'B'
]
```

**Lithology classes:** 139 unique values in `Principal` column

**Data provenance:** Aggregated from IODP LIMS database, binned to 20cm depth intervals.

---

## Preprocessing Pipeline

### DistributionAwareScaler

Defined in `models/vae.py`. Applied before training:

```python
1. Signed log transform for columns [1, 2] (Mag susc, NGR):
   x' = sign(x) * log1p(|x|)

2. Log1p transform for columns [3, 4, 5] (R, G, B):
   x' = log1p(x)

3. StandardScaler on all columns:
   x'' = (x' - mean) / std
```

**Inverse transform** available for reconstruction back to original scale.

### Missing Value Handling

```python
# Remove rows with any NaN in feature columns
valid_mask = ~np.isnan(X).any(axis=1)
X = X[valid_mask]
```

---

## Generated Data Files

### data/embeddings.csv

| Property | Value |
|----------|-------|
| File size | 80,444,218 bytes (80 MB) |
| Generated by | `scripts/generate_embeddings.py` |
| Uses models | `unsup.pt`, `semisup.pt` |

**Schema:** Original 9 columns + 20 embedding columns:
- `unsup_emb_0` through `unsup_emb_9`
- `semisup_emb_0` through `semisup_emb_9`

---

### data/zeroshot_results.csv

| Property | Value |
|----------|-------|
| File size | 1,800 bytes |
| Columns | `variable`, `n_samples`, `r2_v267`, `r2_v214` |
| Rows | 4 |

Initial small-scale zero-shot test results.

---

### data/zeroshot_bootstrap_1337.csv

| Property | Value |
|----------|-------|
| File size | 38,628 bytes |
| Generated by | `run_bootstrap_1337.py` |

**Schema:**
- `variable`: Variable name (e.g., "JR6A: Inclination (deg)")
- `n_samples`: Number of matched samples
- `r2_v267`: Mean R² for unsupervised
- `r2_v267_lo`, `r2_v267_hi`: 2.5th/97.5th percentile (95% CI)
- `r2_v214`: Mean R² for semi-supervised
- `r2_v214_lo`, `r2_v214_hi`: 95% CI

---

### data/zeroshot_bootstrap_full.csv

| Property | Value |
|----------|-------|
| File size | 61,066 bytes |
| Generated by | `run_bootstrap_full.py` |

Same schema as `zeroshot_bootstrap_1337.csv`. Full-sample bootstrap (no train/test split).

---

### data/zeroshot_scatter_results_full.csv

| Property | Value |
|----------|-------|
| File size | 19,745 bytes |
| Source | Copied from `bhai-analysis` repo |

Used by `fig_r2_scatter_with_ci.py` to generate scatter plot.

---

### data/zeroshot_scatter_results_with_ci.csv

| Property | Value |
|----------|-------|
| File size | 50,195 bytes |
| Generated by | `scripts/fig_r2_scatter_with_ci.py` |

Adds confidence interval columns to scatter results.

---

## External Data Dependencies

### LILY Datasets

**Location:** `/home/mnky9800n/clawd/data/lily-datasets/`

Used by `run_bootstrap_1337.py` and `run_bootstrap_full.py` for zero-shot evaluation.

| File | Size | Description |
|------|------|-------------|
| `AVS_DataLITH.csv` | 676 KB | Anisotropy of magnetic susceptibility |
| `CARB_DataLITH.csv` | 3.9 MB | Carbonate content |
| `GE_DataLITH.csv` | 3.2 MB | Geotechnical properties |
| `GRA_DataLITH.csv` | 1.1 GB | Gamma-ray attenuation |
| `ICP_DataLITH.csv` | 2.5 MB | ICP-AES elemental |
| `IW_DataLITH.csv` | 5.5 MB | Interstitial water |
| `JR6A_DataLITH.csv` | 13.3 MB | Paleomagnetic data |
| `KAPPA_DataLITH.csv` | 686 KB | Magnetic susceptibility |
| `MAD_DataLITH.csv` | 10.2 MB | Moisture and density |
| `MS_DataLITH.csv` | 1.1 GB | Magnetic susceptibility (full) |
| `MSP_DataLITH.csv` | 872 MB | MSP measurements |
| `NGR_DataLITH.csv` | 237 MB | Natural gamma radiation |
| `PEN_DataLITH.csv` | 868 KB | Penetrometer |
| `PWB_DataLITH.csv` | 1.5 MB | P-wave velocity (bayonet) |
| `PWC_DataLITH.csv` | 9.4 MB | P-wave velocity (contact) |
| `PWL_DataLITH.csv` | 412 MB | P-wave velocity (logger) |
| ... | | |

**Total:** ~11 GB

**Matching process:**
1. Create `Borehole_ID` = `Exp-Site-Hole`
2. Match on `Borehole_ID` and `Depth_Bin` (±0.5m tolerance)
3. Extract numeric columns, train CatBoost on embeddings

---

## Data Flow Diagram

```
IODP LIMS Database
        │
        ▼
vae_training_data_v2_20cm.csv  ◄── Pre-binned to 20cm intervals
        │
        ├──► DistributionAwareScaler.fit_transform()
        │           │
        │           ▼
        │    Scaled features (N × 6)
        │           │
        │           ▼
        │    VAE/SemiSupervisedVAE training
        │           │
        │           ▼
        │    model checkpoints (.pt)
        │
        ├──► generate_embeddings.py
        │           │
        │           ▼
        │    embeddings.csv (N × 29)
        │
        └──► run_bootstrap_*.py
                    │
                    ├──► Match with LILY datasets
                    │
                    ▼
             zeroshot_*.csv (R² results)
```
